# DevOpTyper Audio System

## Architecture

DevOpTyper uses a dual-engine audio system:

| Channel | Engine | Format | Playback |
|---------|--------|--------|----------|
| **Keyboard SFX** | NAudio WASAPI shared mode | 44100 Hz, 16-bit PCM mono `.wav` | Polyphonic via `MixingSampleProvider`, pre-decoded into memory buffers |
| **Ambient / Soundscapes** | Win32 `mciSendString` (`mpegvideo` type) | Any `.wav` | Single-track looping, random selection per session |

All audio content is discovered dynamically at startup from the filesystem. No code changes are needed to add new themes or soundscapes.

---

## Directory Structure

```
Assets/Sounds/
  Sfx/
    ui_click.wav              # UI feedback (shared across all themes)
    Mechanical/               # CC0 Cherry MX recordings
      key_01.wav ... key_08.wav
    Membrane/                 # Synthesized rubber dome
      key_01.wav ... key_08.wav
    Thock/                    # Synthesized lubed linear + GMK keycaps
      key_01.wav ... key_08.wav
    Clicky/                   # Synthesized Cherry MX Blue / IBM Model M
      key_01.wav ... key_08.wav
  Ambient/
    Default/                  # Ships with the app
      ambient_01.wav ... ambient_05.wav
```

The folder name becomes the display name in the Settings panel. Drop a new folder, rebuild, done.

---

## Adding a Keyboard Theme

1. Create a directory under `Assets/Sounds/Sfx/` (e.g. `HolyPanda/`)
2. Add 4-16 files named `key_01.wav`, `key_02.wav`, etc.
3. Build. The theme appears in the **Keyboard Sound** dropdown automatically.

### Audio specs

| Property | Value |
|----------|-------|
| Sample rate | 44100 Hz |
| Bit depth | 16-bit PCM |
| Channels | Mono (auto-upmixed to stereo at playback) |
| Duration | 60-150 ms recommended |
| Naming | `key_01.wav` through `key_NN.wav` |

The engine picks a random file from the set on every keypress. More files = more natural variation.

### Synthesized themes

Three of the four shipping themes are generated by `AudioTest/GenerateThemes.cs`:

- **Membrane** - rubber dome, 4-pole LP filtered noise + body thud + plate flex, ~90 ms
- **Thock** - deep bottom-out, muffled impact + fundamental/2nd harmonic + case resonance + plate flex + low rumble tail, ~110 ms
- **Clicky** - bright noise snap + buckle resonance + inharmonic overtone + steel plate ping + keycap thock + housing echo, ~100 ms

Each generates 8 variations with subtle pitch/timbre randomization. Run `dotnet run --project AudioTest` to regenerate them into `DevOpTyper/Assets/Sounds/Sfx/`.

### Recording your own

If you have a hot-swap board, record individual keypresses with:
- A condenser mic 6-12 inches from the board
- Room as quiet as possible
- Trim to just the keypress event (attack through tail)
- Normalize to -3 dBFS
- Export 44100 Hz / 16-bit mono WAV
- Aim for 8+ variations (different fingers, different keys)

---

## Adding a Soundscape

1. Create a directory under `Assets/Sounds/Ambient/` (e.g. `CoffeeShop/`)
2. Add one or more `.wav` files (any naming convention)
3. Build. The soundscape appears in the **Soundscape** dropdown automatically.

### Audio specs

| Property | Value |
|----------|-------|
| Sample rate | 44100 Hz recommended (MCI accepts others) |
| Bit depth | 16-bit PCM |
| Channels | Mono or Stereo |
| Duration | 30 seconds minimum, 2-5 minutes ideal |
| Loop point | Seamless loop preferred (crossfade the tail into the head) |

The engine picks a random track from the set and loops it with `mciSendString("play ... repeat")`.

### Prime number layering trick

To prevent users from noticing loop points, use prime-length tracks:

| Track | Duration |
|-------|----------|
| `wind_base.wav` | 17 seconds |
| `birds_sparse.wav` | 31 seconds |
| `leaf_rustle.wav` | 43 seconds |

Because these are coprime, the combined pattern doesn't repeat for 17 x 31 x 43 = **22,661 seconds** (~6.3 hours). This is a future enhancement; the current engine plays one track at a time.

---

## Soundscape Library Plan

### Shipping with the app (Default)

The five `ambient_01..05.wav` files that ship today. Calm, neutral lo-fi atmosphere.

### Planned soundscapes to source and add

#### Ocean & Coastal

| Filename | Description |
|----------|-------------|
| `ocean_arctic_shore_slap.wav` | Cold water hitting ice/rocks, crisp transients |
| `ocean_underwater_bubbling.wav` | Deep muted hydrophone resonance, pairs with thocky keys |
| `coastal_seagulls_distant.wav` | Sparse bird calls over constant low tide |
| `ocean_pebble_retreat.wav` | Water pulling back over small stones, shuffling texture |

#### Mountain & High Altitude

| Filename | Description |
|----------|-------------|
| `mountain_summit_gale.wav` | High-pitched whistling wind, isolation feel |
| `mountain_pine_breeze.wav` | Soft brushed sound through coniferous trees |
| `mountain_distant_rumble.wav` | Barely audible low-frequency thunder |
| `mountain_wind_chime.wav` | Sparse metallic tings in unpredictable breeze |

#### Forest & Woodland

| Filename | Description |
|----------|-------------|
| `forest_bamboo_knock.wav` | Natural thwack sounds that mirror mechanical typing |
| `forest_aspen_shimmer.wav` | Papery rustle, like old books or typewriter paper |
| `forest_canopy_drip.wav` | Unpredictable heavy drops hitting broad leaves |

#### Zen

| Filename | Description |
|----------|-------------|
| `zen_singing_bowl_drone.wav` | Long-tail Tibetan bowl decay, tonal floor |
| `zen_ethereal_pad.wav` | Subdued synth pad, no strong melody |
| `zen_temple_room_tone.wav` | Subtle high-quality silence, adds air and space |
| `zen_library_atmosphere.wav` | Muted background presence of a shared quiet space |
| `zen_sand_raking.wav` | Dry scratch of a rake in a Japanese stone garden |
| `zen_monastery_chant.wav` | Indistinct low humming, tonal foundation |

### Where to source

| Source | License | Notes |
|--------|---------|-------|
| [Freesound.org](https://freesound.org) | CC0 / CC-BY | Search `seamless-loop`, `field-recording` |
| [BBC Sound Effects](https://sound-effects.bbcrewind.co.uk/) | RemArc license (personal/educational) | World-class fidelity, search `Mountain` or `Ocean` |
| [Orange Free Sounds](https://orangefreesounds.com/) | CC-BY / Public Domain | Long-form nature recordings |
| [Kenney Assets](https://kenney.nl/assets?q=audio) | CC0 | Digital/UI audio packs for sci-fi or pop sounds |

---

## Keyboard Sound Repositories

Community projects with pre-labeled switch profiles:

| Project | What's in it |
|---------|-------------|
| **MechSim** | Cherry MX Blue, Holy Panda, Topre, NK Cream profiles |
| **Mechvibes** | Community-contributed packs, folder-per-switch structure |
| **KeyEcho** | Cross-platform keeb emulator with custom sound guide |
| **keyboard-sounds** (nathan-fiscaletti) | 15 bundled profiles + profile editor |
| **Daktilo** | CLI typewriter emulator, vintage + IBM buckling spring presets |

### Adapting external packs

Most external packs use different naming or structure. To import:

1. Copy the `.wav` files into a new `Sfx/ThemeName/` folder
2. Rename to `key_01.wav`, `key_02.wav`, etc.
3. Ensure 44100 Hz, 16-bit, mono (use `ffmpeg` to convert if needed):

```bash
ffmpeg -i input.wav -ar 44100 -ac 1 -sample_fmt s16 key_01.wav
```

---

## Future Enhancements

- **Multi-layer ambient playback** - Play 2-3 ambient tracks simultaneously with independent volumes (the prime number trick)
- **Per-key sound mapping** - Map specific keys (Space, Enter, Backspace) to distinct sounds
- **Live preview** - Play a sample keystroke when hovering over a theme in the dropdown
- **Soundscape crossfade** - Smooth transition when switching soundscapes mid-session
- **Generative ambient** - Use `NAudio` oscillators to synthesize infinite, non-repeating ambient textures
- **Hot-reload** - Watch the `Assets/Sounds/` directory for new folders and refresh dropdowns without restart
