# Dev-Op-Typer v0.2.0 Roadmap

**One-sentence positioning:**
> v0.2.0 turns Dev-Op-Typer from a typing app into a code-typing coach.

**Mental test for every feature:**
> "Does this help a developer type real code more accurately?"
> If the answer isn't a confident yes, it's not v0.2.0 material.

---

## The 4 Pillars

### 1. Per-Character Truth (Visual Precision) — HIGHEST PRIORITY

Typing trainers live or die by feedback accuracy. v0.2.0 must make it immediately obvious: what character you're on, what you got wrong, and why it's wrong.

**Current state:** `TypingPanel` uses a plain `TextBox` — no per-character rendering. `CharDiffAnalyzer` already produces per-character state (Correct/Incorrect/Pending), but it's unused visually.

**Build:**
- [ ] Replace `TextBox` prompt display with per-character `RichTextBlock` or custom `Canvas` renderer
- [ ] Color/style each character: correct (dimmed/green), incorrect (red + underline), pending (default)
- [ ] Non-color error cues for accessibility: underline, squiggly marker, or icon indicator
- [ ] Caret/active-character highlight always visible (line + column awareness)
- [ ] Auto-scroll to keep the caret in view on multi-line snippets
- [ ] Rendering stays smooth on medium/long snippets (100+ chars)
- [ ] Zero false negatives (correct chars never marked wrong)
- [ ] Zero false positives (wrong chars never marked correct)

**Fail condition:** If a user can't instantly see where they went wrong, this pillar fails.

---

### 2. Actionable Learning (Mistake Intelligence)

This is what differentiates Dev-Op-Typer from every other trainer. v0.2.0 must answer: "What am I bad at, specifically?" — not just "accuracy %".

**Current state:** `Profile.WeakChars` is a `HashSet<char>` (non-alphanumeric only). No frequency data, no heatmaps, no aggregation by symbol type.

**Build:**
- [ ] Create `MistakeHeatmap` model — `Dictionary<char, MistakeRecord>` with hit count, miss count, recent trend
- [ ] Track every mistake per character: expected char, typed char, timestamp, snippet context
- [ ] Aggregate by symbol groups:
  - Brackets: `{ } ( ) [ ] < >`
  - Quotes: `' " \``
  - Operators: `=> == != += -= && || ::`
  - Punctuation: `; : , .`
  - Whitespace: spaces, tabs, indentation errors
- [ ] Persist mistake data across sessions (in profile JSON)
- [ ] Display top N weakest symbols in StatsPanel or dedicated analytics view
- [ ] Wire `SmartSnippetSelector` to bias toward weak symbols (weighted, not binary)
- [ ] Adaptive behavior toggle in settings (opt-in, default on)

**Fail condition:** If the app only reports WPM/accuracy and nothing deeper, this pillar fails.

---

### 3. Meaningful Progression (Anti-Grind XP)

Progression should reward clean, intentional typing. Level = competence, not time spent.

**Current state:** XP = `(WPM * Accuracy%) * 0.8 + 25 completion bonus`. No accuracy floor, no difficulty multiplier, no diminishing returns.

**Build:**
- [ ] Accuracy floor: runs below 70% accuracy earn zero XP (configurable threshold)
- [ ] Difficulty multiplier: harder snippets earn proportionally more XP
  - Difficulty 1 = 0.6x, Difficulty 2 = 0.8x, Difficulty 3 = 1.0x, Difficulty 4 = 1.3x, Difficulty 5 = 1.6x
- [ ] Diminishing returns: repeating the same snippet within N sessions reduces XP (e.g., -50% second time, -75% third)
- [ ] Speed bonus curve: XP scales with WPM but with soft cap (diminishing above 80 WPM to avoid rewarding sloppiness)
- [ ] XP formula is documented in code comments and in spec
- [ ] Level curve feels steady — not too fast early, not brick-wall late

**Fail condition:** If users can farm XP mindlessly, this pillar fails.

---

### 4. Advanced Control Without Friction

This is an advanced-only tool — embrace it. Power without clutter.

**Current state:** `AppSettings` has Hardcore mode toggle but no typing rule configuration. No whitespace, backspace, or line ending options.

**Build:**
- [ ] Add `TypingRules` section to `AppSettings`:
  - `WhitespaceStrictness`: Strict (spaces != tabs), Lenient (normalize), Ignore
  - `LineEndingMode`: Exact, Normalize to `\n`, Ignore trailing
  - `BackspaceAllowed`: Always, Limited (N corrections), Never (hardcore)
  - `TrailingSpaces`: Strict, Ignore
  - `AdaptiveDifficulty`: On/Off
- [ ] Apply rules consistently to both target text and typed text
- [ ] Rules do not change mid-session
- [ ] Defaults "just work" — Lenient whitespace, normalized line endings, backspace allowed, adaptive on
- [ ] All controls keyboard-accessible
- [ ] No modal explosions — settings stay in the sidebar

**Fail condition:** If advanced options feel overwhelming or half-explained, this pillar fails.

---

## Implementation Phases

### Phase 1: Data Layer (Foundation)
_Build the models and persistence before touching UI._

| Task | File(s) | Notes |
|------|---------|-------|
| `MistakeHeatmap` model | `Models/MistakeHeatmap.cs` | Per-char frequency tracking, symbol group aggregation |
| `TypingResult` model | `Models/TypingResult.cs` | Full session result (timestamp, language, snippet, WPM, accuracy, errors, XP, difficulty) |
| `SessionHistory` model | `Models/SessionHistory.cs` | List of `TypingResult`, capped at 50, persisted |
| `TypingRules` model | `Models/TypingRules.cs` | Whitespace, line endings, backspace config |
| Add `TypingRules` to `AppSettings` | `Models/AppSettings.cs` | With sane defaults |
| Add `MistakeHeatmap` + `SessionHistory` to `Profile` | `Models/Profile.cs` | Replace `WeakChars` HashSet |
| Persistence migration | `Services/PersistenceService.cs` | v0.1.1 -> v0.2.0 schema upgrade, graceful fallback |

### Phase 2: Engine Logic
_Make the typing engine smarter._

| Task | File(s) | Notes |
|------|---------|-------|
| Apply `TypingRules` in engine | `Services/TypingEngine.cs` | Normalize text based on active rules |
| Track per-char mistakes in engine | `Services/TypingEngine.cs` | Feed mistakes to `MistakeHeatmap` |
| New XP formula | `Models/SessionState.cs` | Accuracy floor, difficulty multiplier, diminishing returns |
| Save `TypingResult` on completion | `MainWindow.xaml.cs` | Persist to `SessionHistory` |
| Heatmap-weighted snippet selection | `Services/SmartSnippetSelector.cs` | Frequency-based weighting, not binary |

### Phase 3: Visual Feedback
_The big UI change — per-character rendering._

| Task | File(s) | Notes |
|------|---------|-------|
| Per-character renderer control | `Controls/TypingRenderer.cs` | Custom WinUI control rendering CharDiff states |
| Wire renderer to TypingEngine diffs | `Panels/TypingPanel.xaml.cs` | Replace TextBlock prompt with renderer |
| Caret tracking + auto-scroll | `Controls/TypingRenderer.cs` | Keep current position in view |
| Non-color error indicators | `Controls/TypingRenderer.cs` | Underline, markers for accessibility |
| High-contrast theme support | `Controls/TypingRenderer.cs` | Must work with HighContrastToggle |

### Phase 4: Analytics UI
_Show the user what they're learning._

| Task | File(s) | Notes |
|------|---------|-------|
| Weakness summary in StatsPanel | `Panels/StatsPanel.xaml` | Top 5-10 weakest symbols |
| Session history view | `Panels/StatsPanel.xaml` or new panel | Recent sessions with WPM/accuracy trends |
| Typing rules UI in settings | `Panels/SettingsPanel.xaml` | Dropdowns/toggles for TypingRules |
| Adaptive difficulty toggle | `Panels/SettingsPanel.xaml` | Under Gameplay section |

### Phase 5: Polish & Stability
_Make it boring-reliable._

| Task | Notes |
|------|-------|
| Persistence migration testing | v0.1.0 and v0.1.1 profiles upgrade cleanly |
| Corrupt state file recovery | Graceful fallback, no crash |
| Long session stability | No leaks, no lag after 30+ minutes |
| Input latency audit | < 15ms perceived response on keypress |
| Multi-session XP verification | Confirm anti-grind logic works across sessions |

---

## What v0.2.0 Does NOT Include

These are explicitly out of scope. Do not build them:

- Multiplayer / leaderboards
- Accounts / cloud sync
- Achievements / cosmetics
- Mobile / touch support
- Large UI redesign beyond per-char rendering
- New programming languages just for count
- Debug drill / fill-in-the-gap modes (v0.3.0+)
- Syntax highlighting in prompt (v0.3.0+)

---

## v0.2.0 Pass Criteria

v0.2.0 is ready when ALL of these are true:

### Per-Character Feedback
- [ ] Prompt is rendered per character, not as a single text block
- [ ] Typed characters are visually distinguished: correct, incorrect, pending
- [ ] Incorrect characters have non-color cues (underline, marker)
- [ ] Current typing position is always obvious
- [ ] Prompt auto-scrolls to keep caret visible
- [ ] Rendering stays smooth on medium/long snippets
- [ ] Zero false negatives, zero false positives

### Typing Engine Correctness
- [ ] Line ending normalization works
- [ ] Trailing space handling works
- [ ] Whitespace strictness works
- [ ] Rules are applied consistently to target and typed text
- [ ] Behavior does not change mid-session
- [ ] Reset/New Test fully resets typing state
- [ ] Backspace behavior is well-defined per mode

### Mistake Intelligence
- [ ] Mistakes tracked per character (expected vs typed)
- [ ] Symbol mistakes aggregated meaningfully (brackets, quotes, operators)
- [ ] Mistake data persists across sessions
- [ ] Top N weak symbols visible in UI
- [ ] Adaptive snippet selection biases toward weak areas
- [ ] Adaptive behavior can be disabled

### Session Results & History
- [ ] Each session produces a full Result object (timestamp, language, snippet, WPM, accuracy, errors, XP, difficulty)
- [ ] Session history persisted (capped at 50)
- [ ] Recent sessions visible in UI
- [ ] Results not double-logged
- [ ] History survives app restart

### XP Integrity
- [ ] XP influenced by accuracy, speed, and difficulty
- [ ] Sloppy runs (< 70% accuracy) earn zero XP
- [ ] Repeated snippets yield diminishing returns
- [ ] Level progression feels steady but earned
- [ ] XP formula documented

### Advanced Control
- [ ] Typing rules available and clearly labeled
- [ ] Backspace / error-lock behavior is explicit
- [ ] Adaptive selection is toggleable
- [ ] Defaults are sane for first-time users
- [ ] All controls keyboard-accessible

### Accessibility & Sensory Safety
- [ ] High-contrast mode works with per-char renderer
- [ ] Reduced sensory mode caps audio intensity
- [ ] Ambient mute does not mute SFX
- [ ] No flashing or rapid visual effects
- [ ] App remains comfortable for 30+ minute sessions

### Stability & Trust
- [ ] No crashes on startup or restart
- [ ] No crashes after multiple consecutive sessions
- [ ] No input lag during fast typing
- [ ] Persistence migration works (v0.1.x -> v0.2.0)
- [ ] Corrupt state file fails gracefully
- [ ] Settings persist exactly as expected

---

## Current Codebase Assessment (v0.1.1 -> v0.2.0 Gap)

| Component | v0.1.1 State | v0.2.0 Need | Gap |
|-----------|-------------|-------------|-----|
| `CharDiffAnalyzer` | Produces correct/incorrect/pending states | Same | Ready |
| `TypingPanel` | Plain TextBox, no per-char rendering | Per-character styled renderer | Major rebuild |
| `Profile.WeakChars` | HashSet (binary, no frequency) | MistakeHeatmap with counts + trends | Replace entirely |
| XP formula | `(WPM * Acc) * 0.8 + 25` | Accuracy floor + difficulty mult + diminishing returns | Rewrite |
| Session history | None | Persistent list of TypingResult objects | New |
| Typing rules | None | Whitespace, line endings, backspace config | New model + UI |
| `SmartSnippetSelector` | Binary weak char check | Frequency-weighted heatmap selection | Enhance |
| `StatsPanel` | WPM, accuracy, errors, XP | + weakness summary + history view | Extend |
| `SettingsPanel` | Audio + Hardcore + Accessibility | + TypingRules + Adaptive toggle | Extend |

---

## Cross-Platform Contract

The Linux version should implement the same 4 pillars with platform-appropriate UI. Shared contracts:

- Same `TypingResult` JSON schema
- Same `MistakeHeatmap` aggregation logic
- Same XP formula (accuracy floor, difficulty mult, diminishing returns)
- Same typing rule definitions
- Same audio assets (see `AUDIO_INTEGRATION_ROADMAP.md`)

This ensures a developer switching between Windows and Linux gets consistent coaching.
