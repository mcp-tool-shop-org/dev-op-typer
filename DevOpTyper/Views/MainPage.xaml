<Page
    x:Class="DevOpTyper.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DevOpTyper.Views"
    xmlns:vm="using:DevOpTyper.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.DataContext>
        <vm:MainViewModel/>
    </Page.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="56"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top bar -->
        <Grid Grid.Row="0" Background="{StaticResource DotSurface2Brush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="12" Margin="16,0">
                <Image Source="/Assets/logo.png" Width="28" Height="28"/>
                <TextBlock Text="Dev-Op-Typer" FontSize="18" FontFamily="Segoe UI Semibold"/>
                <Border Background="{StaticResource DotAccent2Brush}" CornerRadius="999" Padding="10,3" Margin="10,0,0,0">
                    <TextBlock Text="{Binding LevelBadge}" Foreground="Black" FontFamily="Segoe UI Semibold"/>
                </Border>
                <ComboBox Width="160" SelectedItem="{Binding SelectedLanguage, Mode=TwoWay}">
                    <x:String>python</x:String>
                    <x:String>java</x:String>
                </ComboBox>
            </StackPanel>

            <ToggleButton Grid.Column="1"
                          Margin="0,0,12,0"
                          VerticalAlignment="Center"
                          IsChecked="{Binding IsAmbientMuted, Mode=TwoWay}"
                          Content="{Binding AmbientButtonText}"
                          Command="{Binding ToggleAmbientCommand}"/>

            <Button Grid.Column="2"
                    Margin="0,0,16,0"
                    VerticalAlignment="Center"
                    Content="âš™"
                    Command="{Binding ToggleSidebarCommand}"
                    ToolTipService.ToolTip="Advanced settings"/>
        </Grid>

        <!-- Main content with right collapsible sidebar -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="{Binding SidebarWidth}"/>
            </Grid.ColumnDefinitions>

            <!-- Main stage -->
            <Grid Grid.Column="0" Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Button Content="New Test" Command="{Binding NewTestCommand}"/>
                    <Button Content="Reset" Command="{Binding ResetCommand}"/>
                    <TextBlock Text="{Binding SessionStatus}" VerticalAlignment="Center" Margin="12,0,0,0" Style="{StaticResource MutedText}"/>
                </StackPanel>

                <Grid Grid.Row="1" Margin="0,14,0,14">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Prompt -->
                    <Border Style="{StaticResource DotCard}" Margin="0,0,12,0">
                        <StackPanel Spacing="10">
                            <TextBlock Text="{Binding CurrentTitle}" FontSize="16" FontFamily="Segoe UI Semibold"/>
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBlock Text="{Binding TargetText}" FontSize="15" />
                            </ScrollViewer>
                        </StackPanel>
                    </Border>

                    <!-- Stats -->
                    <Border Grid.Column="1" Style="{StaticResource DotCard}">
                        <StackPanel Spacing="10">
                            <TextBlock Text="Live Stats" FontSize="16" FontFamily="Segoe UI Semibold"/>
                            <TextBlock Text="{Binding LiveWpmText}"/>
                            <TextBlock Text="{Binding LiveAccuracyText}"/>
                            <TextBlock Text="{Binding ErrorsText}"/>
                            <TextBlock Text="{Binding XpText}"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Typing box -->
                <Border Grid.Row="2" Style="{StaticResource DotCard}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Type here (code exact-match)" Style="{StaticResource MutedText}"/>
                        <TextBox Text="{Binding TypedText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 AcceptsReturn="True"
                                 FontFamily="Consolas"
                                 FontSize="16"
                                 MinHeight="120"
                                 TextWrapping="Wrap"
                                 KeyDown="TypingBox_KeyDown"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Sidebar -->
            <Border Grid.Column="1"
                    Background="{StaticResource DotSurface2Brush}"
                    Padding="14">
                <ScrollViewer>
                    <StackPanel Spacing="12">
                        <TextBlock Text="Advanced Settings" FontSize="16" FontFamily="Segoe UI Semibold"/>

                        <ToggleSwitch Header="Hardcore (lock errors)"
                                      IsOn="{Binding HardcoreMode, Mode=TwoWay}"/>

                        <Slider Header="Ambient volume"
                                Minimum="0" Maximum="1" Value="{Binding AmbientVolume, Mode=TwoWay}"/>

                        <Slider Header="Keyboard volume"
                                Minimum="0" Maximum="1" Value="{Binding KeyboardVolume, Mode=TwoWay}"/>

                        <Slider Header="UI click volume"
                                Minimum="0" Maximum="1" Value="{Binding UiClickVolume, Mode=TwoWay}"/>

                        <ToggleSwitch Header="High contrast"
                                      IsOn="{Binding HighContrast, Mode=TwoWay}"/>

                        <Button Content="Save Settings"
                                Command="{Binding SaveSettingsCommand}"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

    </Grid>
</Page>
